---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, echo = FALSE, message=FALSE, warning=FALSE}
set.seed(1014)

knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE
)
```

# <img src="https://i.imgur.com/39pvr4n.png" align="right" height=44 /> allodb: Database of allometric equations

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/forestgeo/allodb.svg?branch=master)](https://travis-ci.org/forestgeo/allodb)
[![Coverage status](https://coveralls.io/repos/github/forestgeo/allodb/badge.svg)](https://coveralls.io/r/forestgeo/allodb?branch=master)
[![CRAN status](https://www.r-pkg.org/badges/version/allodb)](https://cran.r-project.org/package=allodb)

The goal of allodb is to develop, host and give access to tables of allometric equations for ForestGEO's network.

## Installation

```
# install.packages("remotes")
remotes::install_github("forestgeo/allodb", auth_token = "abc")
```

For details in how to install packages from GitHub see [this article](https://fgeo.netlify.com/2018/02/05/2018-02-05-installing-packages-from-github/).

## Example

```{r, message=FALSE}
library(dplyr)
library(purrr)
library(bmss)
library(allodb)
```

### Workflow reusing code from the __bmss__ package

This workflow is ad-hoc and incomplete.

* For `allometry_specificity == "Species"`

```{r}
# Restructure equations table and pick species-specific equations
default_eqn <- master() %>% 
  filter(allometry_specificity == "Species") %>% 
  bmss_default_eqn()

# Restructure census to translate species codes to latin names
dbh_sp <- bmss_cns(scbi_tree1, scbi_species, site = "scbi")

# Evauate each equation with its corresponding dbh value
bmss(dbh_sp, default_eqn)
```

* For each category of `allometry_specificity` (`bmss()` could be vectorized to do this automatically -- given a vector of values to match in `allometry_specificity`).

```{r}
bmss_type <- function(dbh_sp, .type) {
  default_type <- master() %>% 
    filter(allometry_specificity == .type) %>% 
    bmss_default_eqn()
  
  suppressMessages(
    bmss(dbh_sp, default_type)
  )
}

types <- master() %>% 
  pull(allometry_specificity) %>% 
  unique() %>% 
  na.omit()

by_type <- types %>% 
  map(~bmss_type(dbh_sp, .type = .x)) %>% 
  set_names(types)

by_type
```




### Tables

```{r}
equations
equations_metadata

missing_values_metadata

references_metadata

sitespecies
sitespecies_metadata

wsg
wsg_metadata

sites_info
```

## Code of conduct

Please note that this project is released with a [Contributor Code of Conduct](.github/CODE_OF_CONDUCT.md). By participating in this project you agree to abide by its terms.
