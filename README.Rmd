---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, echo = FALSE, message=FALSE, warning=FALSE}
set.seed(1014)

knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE
)
```

# <img src="https://i.imgur.com/39pvr4n.png" align="right" height=44 /> allodb: Database of allometric equations

[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/forestgeo/allodb.svg?branch=master)](https://travis-ci.org/forestgeo/allodb)
[![Coverage status](https://coveralls.io/repos/github/forestgeo/allodb/badge.svg)](https://coveralls.io/r/forestgeo/allodb?branch=master)
[![CRAN status](https://www.r-pkg.org/badges/version/allodb)](https://cran.r-project.org/package=allodb)

The goal of allodb is to develop, host and give access to tables of allometric equations for ForestGEO's network.

## Installation

```
# install.packages("remotes")
remotes::install_github("forestgeo/allodb", auth_token = "abc")
```

For details in how to install packages from GitHub see [this article](https://fgeo.netlify.com/2018/02/05/2018-02-05-installing-packages-from-github/).

## Example

```{r, message=FALSE}
library(dplyr)
library(allodb)
```

```{r}
cns_sp <- census_species(allodb::scbi_tree1, allodb::scbi_species, "scbi")
cns_sp
```

```{r}
eqn <- get_equations(cns_sp)
eqn
```

```{r}
best <- pick_best_equations(eqn)
best
```

Deal with duplicated equations

```{r}
find_duplicated_rowid(best)
```

```{r}
# NO duplicated rowid
eqn_1rowid <- pick_one_row_by_rowid(best)
eqn_1rowid

find_duplicated_rowid(eqn_1rowid)
```

Now you may add the equations to the census data.

```{r}
census_equations <- left_join(cns_sp, eqn_1rowid)
census_equations
```

```{r}
nrow(census_equations)
# Same 
nrow(allodb::scbi_tree1)
# Not the same 
nrow(eqn_1rowid)
```

Finally you can evaluate the equations in the context of `dbh`.

```{r}
biomass <- evaluate_equations(census_equations)
biomass
```

And you can summarize the result with __dplyr__ or any other tool.

```{r}
biomass %>% 
  group_by(sp) %>% 
  summarize(biomass = sum(biomass, na.rm = TRUE))
```

