<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using allodb to estimate aboveground biomass • allodb</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using allodb to estimate aboveground biomass">
<meta property="og:description" content="allodb">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">allodb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/allodb-vignette.html">Using allodb to estimate aboveground biomass</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/allodb/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="allodb-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using allodb to estimate aboveground biomass</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/allodb/blob/master/vignettes/allodb-vignette.Rmd"><code>vignettes/allodb-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>allodb-vignette.Rmd</code></div>

    </div>

    
    
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Install the development version of <em>allodb</em> from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"forestgeo/allodb"</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-the-census-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-the-census-data" class="anchor"></a>Load the census data</h2>
<p>Prior to calculating tree biomass using <em>allodb</em>, users need to provide a table (i.e. dataframe) with DBH (cm), parsed species Latin names, and site(s) coordinates. In the following examples we use data from the Smithsonian Conservation Biology Institute, USA (SCBI) ForestGEO dynamics plot (1st census in 2008, trees from 1 hectare). Data can be requested through the ForestGEO portal (<a href="https://forestgeo.si.edu/" class="uri">https://forestgeo.si.edu/</a>)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.github.io/allodb">allodb</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: allodb</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">scbi_stem1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">scbi_stem1</span><span class="op">)</span>
<span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    2287 obs. of  6 variables:</span>
<span class="co">#&gt;  $ treeID : int  2695 1229 1230 1295 1229 66 2600 4936 1229 1005 ...</span>
<span class="co">#&gt;  $ stemID : int  2695 38557 1230 32303 32273 31258 2600 4936 36996 1005 ...</span>
<span class="co">#&gt;  $ dbh    : num  1.41 1.67 1.42 1.04 2.47 ...</span>
<span class="co">#&gt;  $ genus  : chr  "Acer" "Acer" "Acer" "Acer" ...</span>
<span class="co">#&gt;  $ species: chr  "negundo" "negundo" "negundo" "negundo" ...</span>
<span class="co">#&gt;  $ Family : chr  "Sapindaceae" "Sapindaceae" "Sapindaceae" "Sapindaceae" ...</span></code></pre></div>
</div>
<div id="load-and-modify-the-equation-table" class="section level2">
<h2 class="hasAnchor">
<a href="#load-and-modify-the-equation-table" class="anchor"></a>Load and modify the equation table</h2>
<p><code>allodb</code> provides a dataframe containing 570 parsed allometric equations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">equations</span><span class="op">)</span></code></pre></div>
<p>Additional information about the equation table can be found in the equation metadata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">equations_metadata</span><span class="op">)</span></code></pre></div>
<p>This equation table is the default in all functions of the package. Users can modify the set of equations that will be used to estimate biomass using the <code><a href="../reference/new_equations.html">new_equations()</a></code> function: users can work on a subset of those equations, or add new equations to the table (see <code><a href="../reference/new_equations.html">?allodb::new_equations</a></code>). The customized equation table should be provided as an argument in the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> (or other) function (argument name: <code>new_eqtable</code>).</p>
<div id="subset-the-equation-table" class="section level3">
<h3 class="hasAnchor">
<a href="#subset-the-equation-table" class="anchor"></a>Subset the equation table</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">show_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"equation_id"</span>, <span class="st">"equation_taxa"</span>, <span class="st">"equation_allometry"</span><span class="op">)</span>
<span class="va">eq_tab_acer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_equations.html">new_equations</a></span><span class="op">(</span>subset_taxa <span class="op">=</span> <span class="st">"Acer"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">eq_tab_acer</span><span class="op">[</span>, <span class="va">show_cols</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 3</span>
<span class="co">#&gt;   equation_id equation_taxa       equation_allometry                            </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;               &lt;chr&gt;                                         </span>
<span class="co">#&gt; 1 a4e4d1      Acer saccharum      exp(-2.192-0.011*dbh+2.67*(log(dbh)))         </span>
<span class="co">#&gt; 2 dfc2c7      Acer rubrum         2.02338*(dbh^2)^1.27612                       </span>
<span class="co">#&gt; 3 eac63e      Acer rubrum         5.2879*(dbh^2)^1.07581                        </span>
<span class="co">#&gt; 4 f49bcb      Acer pseudoplatanus exp(-5.644074+(2.5189*(log(pi*dbh))))         </span>
<span class="co">#&gt; 5 14bf3d      Acer mandshuricum   0.0335*(dbh)^1.606+0.0026*(dbh)^3.323+0.1222*…</span>
<span class="co">#&gt; 6 0c7cd6      Acer mono           0.0202*(dbh)^1.810+0.0111*(dbh)^2.740+0.1156*…</span></code></pre></div>
</div>
<div id="add-new-equations" class="section level3">
<h3 class="hasAnchor">
<a href="#add-new-equations" class="anchor"></a>Add new equations</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eq_tab_add</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_equations.html">new_equations</a></span><span class="op">(</span>new_taxa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Quercus ilex"</span>, <span class="st">"Castanea sativa"</span><span class="op">)</span>,
                            new_allometry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0.12*dbh^2.5"</span>, <span class="st">"0.15*dbh^2.7"</span><span class="op">)</span>,
                            new_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">44</span><span class="op">)</span>,
                            new_min_dbh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,
                            new_max_dbh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">68</span><span class="op">)</span>,
                            new_sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">143</span>, <span class="fl">62</span><span class="op">)</span><span class="op">)</span>
<span class="co">## show added equations - they contain "new" in their equation_id</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">eq_tab_add</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"new"</span>, <span class="va">eq_tab_add</span><span class="op">$</span><span class="va">equation_id</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 15</span>
<span class="co">#&gt;   equation_id equation_taxa   equation_allome… independent_var… dependent_varia…</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;           </span>
<span class="co">#&gt; 1 new1        Quercus ilex    0.12*dbh^2.5     DBH              Total abovegrou…</span>
<span class="co">#&gt; 2 new2        Castanea sativa 0.15*dbh^2.7     DBH              Total abovegrou…</span>
<span class="co">#&gt; # … with 10 more variables: long &lt;chr&gt;, lat &lt;chr&gt;, koppen &lt;chr&gt;,</span>
<span class="co">#&gt; #   dbh_min_cm &lt;dbl&gt;, dbh_max_cm &lt;dbl&gt;, sample_size &lt;dbl&gt;,</span>
<span class="co">#&gt; #   dbh_units_original &lt;chr&gt;, dbh_unit_cf &lt;dbl&gt;, output_units_original &lt;chr&gt;,</span>
<span class="co">#&gt; #   output_units_cf &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
<div id="estimate-the-aboveground-biomass" class="section level2">
<h2 class="hasAnchor">
<a href="#estimate-the-aboveground-biomass" class="anchor"></a>Estimate the aboveground biomass</h2>
<p>The aboveground biomass (AGB) can be estimated using the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function: the required arguments are the diameter at breast height (DBH, in cm), the taxonomic identification (to the genus or species level), and the location (long-lat coordinates). The output is the aboveground biomass of the tree in kg.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_biomass.html">get_biomass</a></span><span class="op">(</span>
  dbh <span class="op">=</span> <span class="fl">50</span>, 
  genus <span class="op">=</span> <span class="st">"liriodendron"</span>, 
  species <span class="op">=</span> <span class="st">"tulipifera"</span>, 
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78.2</span>, <span class="fl">38.9</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; [1] 1578.644</span></code></pre></div>
<p>The <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function can also be used to estimate the AGB of all trees in one (or several) censuses.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scbi_stem1</span><span class="op">$</span><span class="va">agb</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/get_biomass.html">get_biomass</a></span><span class="op">(</span>
    dbh <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">dbh</span>,
    genus <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">genus</span>,
    species <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">species</span>,
    coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78.2</span>, <span class="fl">38.9</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">dbh</span>,
  y <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">agb</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">scbi_stem1</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span>,
  xlab <span class="op">=</span> <span class="st">"DBH (cm)"</span>,
  ylab <span class="op">=</span> <span class="st">"AGB (kg)"</span>
<span class="op">)</span></code></pre></div>
<p><img src="allodb-vignette_files/figure-html/plot-agb-scbi-1.png" width="576"></p>
</div>
<div id="how-agb-is-estimated" class="section level2">
<h2 class="hasAnchor">
<a href="#how-agb-is-estimated" class="anchor"></a>How AGB is estimated</h2>
<div id="attribute-a-weight-to-each-equation-in-the-equation-table-for-each-taxonlocation-combination" class="section level3">
<h3 class="hasAnchor">
<a href="#attribute-a-weight-to-each-equation-in-the-equation-table-for-each-taxonlocation-combination" class="anchor"></a>Attribute a weight to each equation in the equation table for each taxon/location combination</h3>
<p>Within the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function, new allometric equations are calibrated for each taxon/location combinations in the user-provided dataframe. This is done by attributing a weight to each equation in the equation table, based on its sampling size, and taxonomic and climatic similarity with the taxon/location combination considered.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allom_weights</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/weight_allom.html">weight_allom</a></span><span class="op">(</span>genus <span class="op">=</span> <span class="st">"Acer"</span>,
               species <span class="op">=</span> <span class="st">"rubrum"</span>,
               coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span><span class="op">)</span>

<span class="co">## visualize weights</span>
<span class="va">equ_tab_acer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_equations.html">new_equations</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">equ_tab_acer</span><span class="op">$</span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">allom_weights</span>
<span class="va">keep_cols</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"equation_id"</span>,
    <span class="st">"equation_taxa"</span>,
    <span class="st">"sample_size"</span>,
    <span class="st">"weights"</span><span class="op">)</span>
<span class="va">order_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">equ_tab_acer</span><span class="op">$</span><span class="va">weights</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">equ_tab_acer</span> <span class="op">&lt;-</span> <span class="va">equ_tab_acer</span><span class="op">[</span><span class="va">order_weights</span>, <span class="va">keep_cols</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">equ_tab_acer</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 4</span>
<span class="co">#&gt;   equation_id equation_taxa        sample_size weights</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;                      &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 138258      Acer rubrum                  150   0.415</span>
<span class="co">#&gt; 2 d6be5c      Sapindaceae                  243   0.383</span>
<span class="co">#&gt; 3 a2fbbb      Sapindaceae                  200   0.349</span>
<span class="co">#&gt; 4 2630d5      Trees (Angiosperms)          886   0.299</span>
<span class="co">#&gt; 5 d4c590      Trees (Angiosperms)          549   0.289</span>
<span class="co">#&gt; 6 ed748f      Broad-leaved species        2223   0.270</span></code></pre></div>
</div>
<div id="resample-equations" class="section level3">
<h3 class="hasAnchor">
<a href="#resample-equations" class="anchor"></a>Resample equations</h3>
<p>Equations are then resampled within their original DBH range: the number of resampled values for each equation is proportional to its weight (as attributed by the <code><a href="../reference/weight_allom.html">weight_allom()</a></code> function).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_resample</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/resample_agb.html">resample_agb</a></span><span class="op">(</span>genus <span class="op">=</span> <span class="st">"Acer"</span>,
               species <span class="op">=</span> <span class="st">"rubrum"</span>,
               coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span>, 
               nres <span class="op">=</span> <span class="fl">1e4</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">df_resample</span><span class="op">$</span><span class="va">dbh</span>,
  <span class="va">df_resample</span><span class="op">$</span><span class="va">agb</span>,
  xlab <span class="op">=</span> <span class="st">"DBH (cm)"</span>,
  ylab <span class="op">=</span> <span class="st">"Resampled AGB values (kg)"</span>
<span class="op">)</span></code></pre></div>
<p><img src="allodb-vignette_files/figure-html/resample-acer-1.png" width="576"></p>
</div>
<div id="calibrate-a-new-equation-for-each-taxonlocation-combination" class="section level3">
<h3 class="hasAnchor">
<a href="#calibrate-a-new-equation-for-each-taxonlocation-combination" class="anchor"></a>Calibrate a new equation for each taxon/location combination</h3>
<p>The resampled values are then used to fit the following nonlinear model: <span class="math inline">\(AGB = a \cdot dbh ^ b + e\)</span>, with i.i.d. <span class="math inline">\(e \sim \mathcal{N}(0, sigma^2)\)</span>. The parameters (<em>a</em>, <em>b</em>, and <em>sigma</em>) are returned by the <code><a href="../reference/est_params.html">est_params()</a></code> function. In other words, this function calibrates new allometric equations from sampling previous ones. New allometric equations are calibrated for each species and location by resampling the original compiled equations; equations with a larger sample size, and/or higher taxonomic rank, and climatic similarity with the species and location in question are given a higher weight in this process.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars_acer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_params.html">est_params</a></span><span class="op">(</span>
  genus <span class="op">=</span> <span class="st">"Acer"</span>,
  species <span class="op">=</span> <span class="st">"rubrum"</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">df_resample</span><span class="op">$</span><span class="va">dbh</span>,
  <span class="va">df_resample</span><span class="op">$</span><span class="va">agb</span>,
  xlab <span class="op">=</span> <span class="st">"DBH (cm)"</span>,
  ylab <span class="op">=</span> <span class="st">"Resampled AGB values (kg)"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span><span class="va">pars_acer</span><span class="op">$</span><span class="va">a</span> <span class="op">*</span> <span class="va">x</span> <span class="op">^</span> <span class="va">pars_acer</span><span class="op">$</span><span class="va">b</span>,
      add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="allodb-vignette_files/figure-html/est-params-acer-1.png" width="576"></p>
<p>The <code><a href="../reference/est_params.html">est_params()</a></code> function can be used for all species/site combinations in the dataset at once.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_params.html">est_params</a></span><span class="op">(</span>
  genus <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">genus</span>,
  species <span class="op">=</span> <span class="va">scbi_stem1</span><span class="op">$</span><span class="va">species</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78.2</span>, <span class="fl">38.9</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 7</span>
<span class="co">#&gt;   genus       species      long   lat      a     b sigma</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Acer        negundo     -78.2  38.9 0.0762  2.55  433.</span>
<span class="co">#&gt; 2 Acer        rubrum      -78.2  38.9 0.0768  2.55  412.</span>
<span class="co">#&gt; 3 Ailanthus   altissima   -78.2  38.9 0.0995  2.48  377.</span>
<span class="co">#&gt; 4 Amelanchier arborea     -78.2  38.9 0.0690  2.56  359.</span>
<span class="co">#&gt; 5 Asimina     triloba     -78.2  38.9 0.0995  2.48  377.</span>
<span class="co">#&gt; 6 Carpinus    caroliniana -78.2  38.9 0.0984  2.48  317.</span></code></pre></div>
<p>AGB is then recalculated as <code>AGB = a * dbh^b</code> within the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function.</p>
</div>
</div>
<div id="visualize-the-recalibration-of-equations" class="section level2">
<h2 class="hasAnchor">
<a href="#visualize-the-recalibration-of-equations" class="anchor"></a>Visualize the recalibration of equations</h2>
<p>The recalibrated equation for one taxon/location combination can be easily visualized with the <code><a href="../reference/illustrate_allodb.html">illustrate_allodb()</a></code> function, which returns a ggplot (see package <code>ggplot2</code>) with all resampled values, and the top equations used displayed in the legend. The user can control the number of equations and equation information shown in the legend. The red dotted line is the recalibrated equation used in the <code><a href="../reference/get_biomass.html">get_biomass()</a></code> function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/illustrate_allodb.html">illustrate_allodb</a></span><span class="op">(</span>
  genus <span class="op">=</span> <span class="st">"Acer"</span>,
  species <span class="op">=</span> <span class="st">"rubrum"</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="allodb-vignette_files/figure-html/illustrate-allodb-1.png" width="768"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/illustrate_allodb.html">illustrate_allodb</a></span><span class="op">(</span>
  genus <span class="op">=</span> <span class="st">"Acer"</span>,
  species <span class="op">=</span> <span class="st">"rubrum"</span>,
  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">78</span>, <span class="fl">38</span><span class="op">)</span>, 
  neq <span class="op">=</span> <span class="fl">15</span>, 
  eqinfo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"equation_taxa"</span>, <span class="st">"geographic_area"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="allodb-vignette_files/figure-html/illustrate-allodb2-1.png" width="960"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Erika Gonzalez-Akre, Camille Piponiot, Mauro Lepore, Kristina Anderson-Teixeira.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
